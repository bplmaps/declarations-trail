---
import H1 from "../../components/h1.astro";
import { formatDate, parseEventDate } from "../../lib/utils";
import { getCollection } from "astro:content";
import InfoLayout from "../../layouts/InfoLayout.astro";

const allEvents = await getCollection("events");
const events = allEvents
  .filter((event) => !event.data.isDraft)
  .sort(
    (a, b) =>
      parseEventDate(a.data.eventDate).getTime() -
      parseEventDate(b.data.eventDate).getTime()
  );
---

<InfoLayout>
  <div class="p-4 sm:pt-8 sm:px-12 pb-20 min-h-dvh">
    <H1>Events</H1>

    <ul class="mt-4 sm:mt-12 space-y-6">
      {events.map((event) => (
        <li class="space-y-2">
          <h2 class="text-xl xl:text-2xl text-zinc-300 text-balance font-medium">
            {event.data.title}
          </h2>
          {event.data.institution && (
            <div class="text-base text-zinc-400">
              <span>{event.data.institution}</span>
            </div>
          )}
          <p class="text-base text-zinc-400">{event.data.snippet}</p>
          <p class="text-sm text-zinc-500">
            {formatDate(event.data.eventDate, { withTime: true })}

              <>
                {" "}&middot;{" "}
                {event.data.url?.trim() ? (
                  <a
                    href={event.data.url}
                    class="underline text-zinc-400 hover:text-zinc-300"
                    rel="noopener noreferrer"
                    target="_blank"
                  >
                    More info
                  </a>
                ) : (
                  <span class="inline-block bg-zinc-800 text-zinc-400 rounded px-2 py-0.5 text-xs align-middle ml-1">
                    More information coming soon
                  </span>
                )}
              </>
          </p>

        </li>
      ))}
    </ul>
  </div>
</InfoLayout>
